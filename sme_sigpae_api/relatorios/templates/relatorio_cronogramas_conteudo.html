<!DOCTYPE html>
{% load index %}
{% load static %}
{% load sass_tags %}

<html lang="pt-BR">
  <body>
    <main>
      {% for pagina in paginas %}
        <table class="tabela-externa">
          <thead>
            <tr>
              <th>Nº do Cronograma</th>
              <th>Produto</th>
              <th>Empresa</th>
              <th>Quantidade</th>
              <th>Armazém</th>
              <th>Status</th>
            </tr>
          </thead>

          <tbody>
            {% for cronograma in pagina %}
              <tr>
                <td>{{ cronograma.numero|default:"-" }}</td>
                <td>
                  {{ cronograma.produto|default:"-" }}
                  {% if cronograma.programa_leve_leite %}
                    <span class="tag-leve-leite">LEVE LEITE - PLL</span>
                  {% endif %}
                </td>
                <td>{{ cronograma.empresa|default:"-" }}</td>
                <td>{{ cronograma.qtd_total_programada|default:"-" }}</td>
                <td>{{ cronograma.armazem|default:"-" }}</td>
                <td>{{ cronograma.status|default:"-" }}</td>
              </tr>

              <tr>
                <td colspan="3" class="celula-sem-borda">
                  Marca: <strong>{{ cronograma.marca|default:"-" }}</strong>
                </td>
                <td colspan="3" class="celula-sem-borda">
                  Custo unitário: <strong>{{ cronograma.custo_unitario_produto|default:"-" }}</strong>
                </td>
              </tr>

              <tr>
                <td colspan="6" class="celula-sem-borda">
                  <table class="tabela-interna">
                    <thead>
                      <tr>
                        <th>Etapa</th>
                        <th>Parte</th>
                        <th>Data programada</th>
                        <th>Quantidade</th>
                        <th>Total de Embalagens</th>
                        <th>Situação</th>
                      </tr>
                    </thead>

                    <tbody>
                      {% for etapa in cronograma.etapas %}
                        {% if etapa.fichas_recebimento %}
                          {% for ficha in etapa.fichas_recebimento %}
                            <tr>
                              <td>
                                {% if ficha.houve_reposicao %}
                                  {{ etapa.etapa }} - {{ etapa.parte }} - Reposição / Pagamento de Notificação
                                {% else %}
                                  {{ etapa.etapa|default:"-" }}
                                {% endif %}
                              </td>
                              <td>
                                {% if not ficha.houve_reposicao %}
                                  {{ etapa.parte|default:"-" }}
                                {% endif %}
                              </td>
                              <td>{{ etapa.data_programada|default:"-" }}</td>
                              <td>{{ etapa.quantidade|default:"-" }}</td>
                              <td>{{ etapa.total_embalagens|default:"-" }}</td>
                              <td>{{ ficha.situacao|default:"-" }}</td>
                            </tr>
                          {% endfor %}
                        {% endif %}

                        {% if not etapa.fichas_recebimento or not etapa.foi_recebida %}
                          {% if not filtros.situacao or "A Receber" in filtros.situacao %}
                            <tr>
                              <td>{{ etapa.etapa|default:"-" }}</td>
                              <td>{{ etapa.parte|default:"-" }}</td>
                              <td>{{ etapa.data_programada|default:"-" }}</td>
                              <td>{{ etapa.quantidade|default:"-" }}</td>
                              <td>{{ etapa.total_embalagens|default:"-" }}</td>
                              <td>A receber</td>
                            </tr>
                          {% endif %}
                        {% endif %}
                      {% endfor %}
                    </tbody>
                  </table>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endfor %}
    </main>

  </body>
</html>
