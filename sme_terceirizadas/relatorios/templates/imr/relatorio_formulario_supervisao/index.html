{% include 'relatorio_base.html' %} {% load static %} {% load index %} {% load sass_tags %}

<html lang="en">
<head>
  <link rel="stylesheet" href="{% sass_src 'css/relatorio_formulario_supervisao.scss' %}" type="text/css">
  <link rel="stylesheet" href="{% sass_src 'css/custom_bootstrap.scss' %}" type="text/css">
</head>

<body>
   {% include "imr/relatorio_formulario_supervisao/cabecalho.html" with formulario_supervisao=formulario_supervisao %}
  <table class="formulario-supervisao">
    {% for tipo_ocorrencia in tipos_ocorrencia %}
      {% with index_minus_one=forloop.counter0|add:"-1" %}
        {% if forloop.counter0 == 0 or tipos_ocorrencia|get_element_by_index:index_minus_one|get_attribute:"categoria" != tipo_ocorrencia.categoria %}
          <tr class="categoria">
            <th class="pb-3" colspan="3">
              {{ tipo_ocorrencia.categoria.nome }}
            </th>
          </tr>
          {% if tipo_ocorrencia.categoria.gera_notificacao %}
            <tr class="frequencia">
              <th class="pb-3" colSpan={3}>
                Maior frequência no período: {{ formulario_supervisao.maior_frequencia_no_periodo }}
              </th>
            </tr>
          {% endif %}
        {% endif %}
        <tr class="tipo-ocorrencia">
          <td>{{ forloop.counter }}</td>
          <td>
            <div>
              <b>{{ tipo_ocorrencia.titulo }}:</b> {{ tipo_ocorrencia.descricao }}
            </div>
            <div>
              <b>
                Penalidade: {{ tipo_ocorrencia.penalidade.numero_clausula }}<br />
                Obrigação: {{ tipo_ocorrencia.penalidade.obrigacoes.all|concatena_str_por_param:"descricao" }}
              </b>
            </div>
          </td>
          <td>Sim</td>
        </tr>
      {% endwith %}
    {% endfor %}
  </table>
</body>
</html>
